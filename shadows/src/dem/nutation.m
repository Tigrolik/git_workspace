function [delta_psi, delta_eps] = nutation(JCE)

% function [delta_psi, delta_eps] = nutation(JCE) calculates the nutation
% in longitude and obliquity
% JCE - Julian Ephemeris Century

nX = 5;
X = zeros(1, nX);

% X0 - mean elongation of the Moon from the Sun
X(1) = 297.85036 + 445267.111480 * JCE - 0.0019142 * JCE^2 + JCE^3/189474;

% X1 - mean anomaly of the Sun (Earth)
X(2) = 357.52772 + 35999.050340 * JCE - 0.0001603 * JCE^2 - JCE^3/300000;

% X2 - mean anomaly of the Moon
X(3) = 134.96298 + 477198.867398 * JCE + 0.0086972 * JCE^2 + JCE^3/56250;

% X3 - Moon's argument of latitude
X(4) = 93.27191 + 483202.017538 * JCE - 0.0036825 * JCE^2 + JCE^3/327270;

% X4 - longitude of the ascending node of the moon's mean orbit on the
% ecliptic measured from the mean equinox of the date
X(5) = 125.04452 - 1934.136261 * JCE + 0.0020708 * JCE^2 + JCE^3/450000;

YPT = [
    0,  0,  0,  0, 1;
   -2,  0,  0,  2, 2;
    0,  0,  0,  2, 2;
    0,  0,  0,  0, 2;
    0,  1,  0,  0, 0;
    0,  0,  1,  0, 0;
   -2,  1,  0,  2, 2;
    0,  0,  0,  2, 1;
    0,  0,  1,  2, 2;
   -2, -1,  0,  2, 2;
   -2,  0,  1,  0, 0;
   -2,  0,  0,  2, 1;
    0,  0, -1,  2, 2;
    2,  0,  0,  0, 0;
    0,  0,  1,  0, 1;
    2,  0, -1,  2, 2;
    0,  0, -1,  0, 1;
    0,  0,  1,  2, 1;
   -2,  0,  2,  0, 0;
    0,  0, -2,  2, 1;
    2,  0,  0,  2, 2;
    0,  0,  2,  2, 2;
    0,  0,  2,  0, 0;
   -2,  0,  1,  2, 2;
    0,  0,  0,  2, 0;
   -2,  0,  0,  2, 0;
    0,  0, -1,  2, 1;
    0,  2,  0,  0, 0;
    2,  0, -1,  0, 1;
   -2,  2,  0,  2, 2;
    0,  1,  0,  0, 1;
   -2,  0,  1,  0, 1;
    0, -1,  0,  0, 1;
    0,  0,  2, -2, 0;
    2,  0, -1,  2, 1;
    2,  0,  1,  2, 2;
    0,  1,  0,  2, 2;
   -2,  1,  1,  0, 0;
    0, -1,  0,  2, 2;
    2,  0,  0,  2, 1;
    2,  0,  1,  0, 0;
   -2,  0,  2,  2, 2;
   -2,  0,  1,  2, 1;
    2,  0, -2,  0, 1;
    2,  0,  0,  0, 1;
    0, -1,  1,  0, 0;
   -2, -1,  0,  2, 1;
   -2,  0,  0,  0, 1;
    0,  0,  2,  2, 1;
   -2,  0,  2,  0, 1;
   -2,  1,  0,  2, 1;
    0,  0,  1, -2, 0;
   -1,  0,  1,  0, 0;
   -2,  1,  0,  0, 0;
    1,  0,  0,  0, 0;
    0,  0,  1,  2, 0;
    0,  0, -2,  2, 2;
   -1, -1,  1,  0, 0;
    0,  1,  1,  0, 0;
    0, -1,  1,  2, 2;
    2, -1, -1,  2, 2;
    0,  0,  3,  2, 2;
    2, -1,  0,  2, 2
];

PsiPT = [
    -171996, -174.2;
     -13187,   -1.6;
      -2274,   -0.2;
       2062,    0.2;
       1426,   -3.4;
        712,    0.1;
       -517,    1.2;
       -386,   -0.4;
       -301,      0;
        217,   -0.5;
       -158,      0;
        129,    0.1;
        123,      0;
         63,      0;
         63,    0.1;
        -59,      0;
        -58,   -0.1;
        -51,      0;
         48,      0;
         46,      0;
        -38,      0;
        -31,      0;
         29,      0;
         29,      0;
         26,      0;
        -22,      0;
         21,      0;
         17,   -0.1;
         16,      0;
        -16,    0.1;
        -15,      0;
        -13,      0;
        -12,      0;
         11,      0;
        -10,      0;
         -8,      0;
          7,      0;
         -7,      0;
         -7,      0;
         -7,      0;
          6,      0;
          6,      0;
          6,      0;
         -6,      0;
         -6,      0;
          5,      0;
         -5,      0;
         -5,      0;
         -5,      0;
          4,      0;
          4,      0;
          4,      0;
         -4,      0;
         -4,      0;
         -4,      0;
          3,      0;
         -3,      0;
         -3,      0;
         -3,      0;
         -3,      0;
         -3,      0;
         -3,      0;
         -3,      0

];

EpsPT = [
    92025,  8.9;
     5736, -3.1;
      977, -0.5;
     -895,  0.5;
       54, -0.1;
       -7,    0;
      224, -0.6;
      200,    0;
      129, -0.1;
      -95,  0.3;
        0,    0;
      -70,    0;
      -53,    0;
        0,    0;
      -33,    0;
       26,    0;
       32,    0;
       27,    0;
        0,    0;
      -24,    0;
       16,    0;
       13,    0;
        0,    0;
      -12,    0;
        0,    0;
        0,    0;
      -10,    0;
        0,    0;
       -8,    0;
        7,    0;
        9,    0;
        7,    0;
        6,    0;
        0,    0;
        5,    0;
        3,    0;
       -3,    0;
        0,    0;
        3,    0;
        3,    0;
        0,    0;
       -3,    0;
       -3,    0;
        3,    0;
        3,    0;
        0,    0;
        3,    0;
        3,    0;
        3,    0;
        0,    0;
        0,    0;
        0,    0;
        0,    0;
        0,    0;
        0,    0;
        0,    0;
        0,    0;
        0,    0;
        0,    0;
        0,    0;
        0,    0;
        0,    0;
        0,    0
];

XY = sum(repmat(X, size(YPT, 1), 1) .* YPT, 2) * pi / 180;
% delta psi (in 0.0001 of arc seconds => in degrees)
delta_psi = sum((PsiPT(:, 1) + PsiPT(:, 2) * JCE) .* sin(XY)) / 36000000;
% delta epsilon
delta_eps = sum((EpsPT(:, 1) + EpsPT(:, 2) * JCE) .* cos(XY)) / 36000000;
